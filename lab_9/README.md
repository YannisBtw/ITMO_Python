

# üìò **–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ9 ‚Äî CRUD –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç c SQLite –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö**

---

# **1. –¶–µ–ª—å —Ä–∞–±–æ—Ç—ã**

* –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å CRUD (Create, Read, Update, Delete) –¥–ª—è —Å—É—â–Ω–æ—Å—Ç–µ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
* –û—Å–≤–æ–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å SQLite (—Ä–µ–∂–∏–º in-memory –∏ —Ñ–∞–π–ª).
* –ü–æ–Ω—è—Ç—å –ø—Ä–∏–Ω—Ü–∏–ø—ã –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∏ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π –∏ –∏—Ö —Ä–æ–ª—å –≤ —Å–≤—è–∑—è—Ö –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏.
* –í—ã–¥–µ–ª–∏—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î –∏ –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —Å—Ç—Ä–∞–Ω–∏—Ü –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏.
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É MVC –∏ —Å–æ–±–ª—é–¥–∞—Ç—å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏.
* –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Ç–∞–±–ª–∏—Ü—É —Å –≤–∞–ª—é—Ç–∞–º–∏, –Ω–∞ –∫–æ—Ç–æ—Ä—ã–µ –æ–Ω–∏ –ø–æ–¥–ø–∏—Å–∞–Ω—ã.
* –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π —Ä–æ—É—Ç–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç GET-–∑–∞–ø—Ä–æ—Å—ã –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü.
* –ù–∞—É—á–∏—Ç—å—Å—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–∞ –ø—Ä–∏–º–µ—Ä–µ —Å—É—â–Ω–æ—Å—Ç–µ–π currency –∏ user —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º unittest.mock.

---

# **2. –û–ø–∏—Å–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π, –∏—Ö —Å–≤–æ–π—Å—Ç–≤ –∏ —Å–≤—è–∑–µ–π**

## **2.1. User**

| –ü–æ–ª–µ   | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ         |
| ------ | --- | ---------------- |
| `id`   | int | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á   |
| `name` | str | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |

–í–∞–ª–∏–¥–∞—Ü–∏—è:

* ID > 0
* –ò–º—è ‚â• 2 —Å–∏–º–≤–æ–ª–æ–≤

**–°–≤—è–∑—å:**
User (1) ‚Äî (N) UserCurrency

---

## **2.2. Currency**

| –ü–æ–ª–µ        | –¢–∏–ø   | –û–ø–∏—Å–∞–Ω–∏–µ                   |
| ----------- | ----- | -------------------------- |
| `id`        | int   | Primary Key                |
| `num_code`  | str   | –ß–∏—Å–ª–æ–≤–æ–π –∫–æ–¥ –≤–∞–ª—é—Ç—ã        |
| `char_code` | str   | –°–∏–º–≤–æ–ª—å–Ω—ã–π –∫–æ–¥ (USD, EUR‚Ä¶) |
| `name`      | str   | –ù–∞–∑–≤–∞–Ω–∏–µ –≤–∞–ª—é—Ç—ã            |
| `value`     | float | –¢–µ–∫—É—â–∏–π –∫—É—Ä—Å               |
| `nominal`   | int   | –ù–æ–º–∏–Ω–∞–ª                    |

–í–∞–ª–∏–¥–∞—Ü–∏—è:

* –∫—É—Ä—Å > 0
* –Ω–æ–º–∏–Ω–∞–ª > 0
* —Å–∏–º–≤–æ–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª–∏–Ω–æ–π 2‚Äì5 —Å–∏–º–≤–æ–ª–æ–≤

---

## **2.3. UserCurrency**

–¢–∞–±–ª–∏—Ü–∞ —Å–≤—è–∑–∏ **–º–Ω–æ–≥–∏–µ-–∫–æ-–º–Ω–æ–≥–∏–º**.

```sql
CREATE TABLE user_currency (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    currency_id INTEGER NOT NULL,
    FOREIGN KEY (user_id) REFERENCES user(id),
    FOREIGN KEY (currency_id) REFERENCES currency(id)
);
```

---

# **3. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ —Å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ–º —Ñ–∞–π–ª–æ–≤**

```
lab_9/
‚îÇ
‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îú‚îÄ‚îÄ currencycontroller.py      # –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤–∞–ª—é—Ç
‚îÇ   ‚îú‚îÄ‚îÄ databasecontroller.py      # CRUD + SQL
‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îÇ
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ user.py                    # –º–æ–¥–µ–ª—å User
‚îÇ   ‚îú‚îÄ‚îÄ currency.py                # –º–æ–¥–µ–ª—å Currency
‚îÇ   ‚îú‚îÄ‚îÄ user_currency.py           # –º–æ–¥–µ–ª—å —Å–≤—è–∑–∏
‚îÇ   ‚îú‚îÄ‚îÄ author.py                  # –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–≤—Ç–æ—Ä–µ
‚îÇ   ‚îú‚îÄ‚îÄ app.py                     # –º–æ–¥–µ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ __init__.py
‚îÇ
‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îú‚îÄ‚îÄ index.html                 # –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ   ‚îú‚îÄ‚îÄ users.html                 # —Å–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ user.html                  # –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ currencies.html            # —Ç–∞–±–ª–∏—Ü–∞ –≤–∞–ª—é—Ç
‚îÇ   ‚îú‚îÄ‚îÄ author.html                # –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–≤—Ç–æ—Ä–µ
‚îÇ
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îî‚îÄ‚îÄ currencies_api.py          # –ø–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—Å–æ–≤ –≤–∞–ª—é—Ç —Å API
‚îÇ
‚îú‚îÄ‚îÄ tests/
‚îÇ   ‚îú‚îÄ‚îÄ test_currency_model.py
‚îÇ   ‚îú‚îÄ‚îÄ test_user_model.py
‚îÇ   ‚îú‚îÄ‚îÄ test_currency_controller.py
‚îÇ
‚îú‚îÄ‚îÄ currency.db                    # –±–∞–∑–∞ SQLite
‚îî‚îÄ‚îÄ myapp.py                       # –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è
```

---

# **4. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è CRUD —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤**

## **4.1. CREATE**

```sql
INSERT INTO currency (num_code, char_code, name, value, nominal)
VALUES (?, ?, ?, ?, ?);
```

Python:

```python
cursor.execute(sql, (
    currency.num_code,
    currency.char_code,
    currency.name,
    currency.value,
    currency.nominal
))
```

---

## **4.2. READ**

–í—Å–µ –≤–∞–ª—é—Ç—ã:

```sql
SELECT * FROM currency;
```

–ü–æ char_code:

```sql
SELECT * FROM currency WHERE char_code = ?;
```

---

## **4.3. UPDATE**

```sql
UPDATE currency SET value = ? WHERE char_code = ?;
```

---

## **4.4. DELETE**

```sql
DELETE FROM currency WHERE id = ?;
```

---

# **5. –°–∫—Ä–∏–Ω—à–æ—Ç—ã —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**

üëá *–í—Å—Ç–∞–≤—å —Å—é–¥–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–≤–æ–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤*.

### **5.1. –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ( / )**

![main.png](static%2Fmain.png)

### **5.2. –¢–∞–±–ª–∏—Ü–∞ –≤–∞–ª—é—Ç ( /currencies )**

![img_2.png](static/currencies.png)

### **5.3. –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ( /user?id=1 )**

![img_1.png](static/user_profile.png)

### **5.4. –ü—Ä–∏–º–µ—Ä –ë–∞–∑ –¥–∞–Ω–Ω—ã—Ö:*
![img.png](static/db_1.png)
![img_1.png](static/db_2.png)


# **6. –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤ —Å unittest.mock –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**

## ‚úî –¢–µ—Å—Ç –º–æ–¥–µ–ª–∏ Currency

```python
def test_invalid_value_raises(self):
    with self.assertRaises(ValueError):
        Currency(currency_id=1, char_code="USD", value=-5, nominal=1)
```

---

## ‚úî –¢–µ—Å—Ç –º–æ–¥–µ–ª–∏ User

```python
def test_invalid_name(self):
    with self.assertRaises(ValueError):
        User(user_id=1, name="A")
```

---

## ‚úî –¢–µ—Å—Ç –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ —Å mock –ë–î

```python
def test_list_currencies(self):
    mock_db = MagicMock()
    mock_db.read_all.return_value = [{"id": 1, "char_code": "USD"}]

    controller = CurrencyController(mock_db)
    result = controller.list_currencies()

    assert result[0]["char_code"] == "USD"
    mock_db.read_all.assert_called_once()
```

---

## ‚úî –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:

```
----------------------------------------------------------------------
Ran 7 tests in 0.004s

OK
```

---

# **7. –í—ã–≤–æ–¥—ã –æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ MVC, —Ä–∞–±–æ—Ç–µ —Å SQLite, –æ–±—Ä–∞–±–æ—Ç–∫–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ —à–∞–±–ª–æ–Ω–æ–≤**

1. –í —Ä–∞–±–æ—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ MVC:

   * **–ú–æ–¥–µ–ª–∏** –æ—Ç–≤–µ—á–∞—é—Ç –∑–∞ –¥–∞–Ω–Ω—ã–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é.
   * **–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã** –≤—ã–ø–æ–ª–Ω—è—é—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–µ–π—Å—Ç–≤–∏–π –∏ CRUD —Å SQLite.
   * **–ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (Views)** —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è —á–µ—Ä–µ–∑ Jinja2.
   * **Router (myapp.py)** –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç GET-–º–∞—Ä—à—Ä—É—Ç—ã.

2. SQLite –ø–æ–∑–≤–æ–ª–∏–ª–∞ —Å–æ–∑–¥–∞—Ç—å –Ω–∞–¥—ë–∂–Ω—É—é, —Å–≤—è–∑–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü —Å –≤–Ω–µ—à–Ω–∏–º–∏ –∫–ª—é—á–∞–º–∏.

3. CRUD –¥–ª—è Currency —É—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω.

4. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ **–ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –ø–æ–¥–ø–∏—Å–∫–∏ (many-to-many).

5. –°–∏—Å—Ç–µ–º–∞ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:

   * –≤—ã–≤–æ–¥ –≤–∞–ª—é—Ç
   * –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
   * —É–¥–∞–ª–µ–Ω–∏–µ
   * –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è
   * –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫

6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å `unittest.mock` –ø–æ–∑–≤–æ–ª–∏–ª–æ –∏–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–æ–∫—Ä—ã—Ç—å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –±–µ–∑ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

7. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º: —Ñ–æ—Ä–º–∞—Ç—ã, —Ç–∏–ø—ã, PEP-8, PEP-257, MVC, –º–∞—Ä—à—Ä—É—Ç—ã, —Ç–µ—Å—Ç—ã, CRUD.

